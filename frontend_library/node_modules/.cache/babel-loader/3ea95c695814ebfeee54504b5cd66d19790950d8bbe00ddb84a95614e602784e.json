{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport NavBar from \"../../components/NavBar.vue\";\nimport axios from \"axios\";\nexport default {\n  data() {\n    return {\n      userName: \"\",\n      books: [],\n      searchBar: \"\"\n    };\n  },\n  name: \"UserDashboard\",\n  components: {\n    NavBar\n  },\n  computed: {\n    bookSections() {\n      return Array.from(new Set(this.books.map(book => book.section)));\n    }\n  },\n  methods: {\n    async getBookList() {\n      try {\n        const response = await axios.get(\"http://127.0.0.1:5000/api/books\", {\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem(\"accessToken\")}`\n          }\n        });\n        this.books = response.data;\n        await this.setUsersLastVisitTime();\n        await this.fetchBookCovers();\n      } catch (error) {\n        console.error(\"Error fetching books:\", error);\n      }\n    },\n    readBook(book_id) {\n      this.$router.push({\n        name: 'BookPage',\n        params: {\n          id: book_id\n        }\n      });\n    },\n    searchSections(section) {\n      return this.books.filter(book => {\n        const sectionMatch = book.section === section;\n        const searchMatch = book.name.toLowerCase().includes(this.searchBar.toLowerCase()) || book.authors.toLowerCase().includes(this.searchBar.toLowerCase());\n        return sectionMatch && (this.searchBar === \"\" || searchMatch);\n      });\n    },\n    async fetchBookCovers() {\n      for (const book of this.books) {\n        try {\n          const coverUrl = await this.getBookCover(book);\n          book.coverUrl = coverUrl;\n        } catch (error) {\n          console.error(\"Error fetching book cover:\", error);\n          book.coverUrl = null;\n        }\n      }\n    },\n    getBookCover(book) {\n      const apiUrl = `http://localhost:5000/bookcover?book_title=${encodeURIComponent(book.name)}\n      &author_name=${encodeURIComponent(book.authors)}\n      &isbn=${encodeURIComponent(book.isbn)}`;\n      return axios.get(apiUrl).then(response => {\n        console.log(response.data);\n        return response.data;\n      }).catch(error => {\n        console.error(\"Error fetching book cover:\", error);\n        return null;\n      });\n    },\n    userRequests(bookId, sectionName) {\n      console.log(bookId, sectionName);\n      const requestData = {\n        book_id: bookId\n      };\n      axios.post(\"http://127.0.0.1:5000/api/request/book\", requestData, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"accessToken\")}`\n        }\n      }).then(response => {\n        console.log(response.data);\n        console.log(\"Request sent\");\n        this.getBookList();\n      }).catch(error => {\n        alert(error.response.data.error);\n        console.log(error);\n      });\n    },\n    async setUsersLastVisitTime() {\n      const response = await axios.post(\"http://127.0.0.1:5000/api/track-last-login\", {}, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"accessToken\")}`\n        }\n      });\n      if (response.status === 200) {\n        console.log(\"Last login time updated: \", response.data);\n      } else {\n        console.error(\"Failed to update last login time: \", response.data.error);\n      }\n    },\n    scrollHorizontal(direction) {\n      const scrollContainer = document.querySelector(\".row\");\n      const scrollAmount = 300 * direction;\n      scrollContainer.scrollBy({\n        left: scrollAmount,\n        behavior: \"smooth\"\n      });\n    }\n  },\n  mounted() {\n    this.userName = JSON.parse(localStorage.getItem(\"user\"));\n    this.getBookList();\n  }\n};","map":{"version":3,"names":["NavBar","axios","data","userName","books","searchBar","name","components","computed","bookSections","Array","from","Set","map","book","section","methods","getBookList","response","get","headers","Authorization","localStorage","getItem","setUsersLastVisitTime","fetchBookCovers","error","console","readBook","book_id","$router","push","params","id","searchSections","filter","sectionMatch","searchMatch","toLowerCase","includes","authors","coverUrl","getBookCover","apiUrl","encodeURIComponent","isbn","then","log","catch","userRequests","bookId","sectionName","requestData","post","alert","status","scrollHorizontal","direction","scrollContainer","document","querySelector","scrollAmount","scrollBy","left","behavior","mounted","JSON","parse"],"sources":["C:\\Users\\vijay\\OneDrive\\Desktop\\National-Library-LMS\\Library_Code\\frontend_library\\src\\views\\User\\UserDashboard.vue"],"sourcesContent":["<template>\n   \n  <div>\n    <NavBar/>\n   <div>\n    <h3 style=\"text-align: center;font-weight: bold;margin-top: 1%;\">Welcome, {{ userName }}</h3>\n    <input style=\"width:100%;padding: 0.5%;border-width:0.5cap;border-radius: 10cqb; color:black;font-weight: 700;font-size:large;text-align: center;border-color: black;margin-bottom:2%\" type=\"text\" v-model=\"searchBar\" placeholder=\"Search by book or author\">\n  </div>\n    <div v-for=\"(section, index) in bookSections\" :key=\"index\">\n      <div class=\"section-title-wrapper\">\n        <h2 class=\"section-title\">{{ section }}</h2>\n      </div>\n      <button class=\"scroll-button prev\" @click=\"scrollHorizontal(-1)\">\n          <i class=\"bi bi-arrow-left\"></i>\n        </button>\n        <button class=\"scroll-button next\" @click=\"scrollHorizontal(1)\">\n          <i class=\"bi bi-arrow-right\"></i>\n        </button>\n      <div class=\"row\" style=\"background-color:whitesmoke;\">\n        <div v-for=\"book in searchSections(section)\" :key=\"book.id\" class=\"card\" style=\"background-color:whitesmoke;\">\n          <div class=\"card-body\">\n            <button @click=\"readBook(book.id)\" style=\"border: none;\">\n            <template v-if=\"book.coverUrl\">\n              <img :src=\"book.coverUrl\" loading=\"lazy\" class=\"card-img-top\"\n                :class=\"{ 'disabled-image': book.requested || book.allocated }\" alt=\"Book Cover\">\n            </template>\n            <template v-else>\n              <img src=\"@/assets/default.jpeg\" loading=\"lazy\" class=\"card-img-top\" alt=\"Default Cover\">\n            </template>\n          </button>\n            <h6 class=\"card-subtitle mb-2 text-muted\" style=\"text-align: center;\"> by {{ book.authors }}</h6>\n            <div class=\"book-actions text-center\">\n              <button v-if=\"book.read === 0 && book.allocated === 0 && !book.requested\" type=\"button\"\n                class=\"btn btn-primary mr-2\" @click=\"userRequests(book.id, book.section)\">\n                Request\n              </button>\n              <button v-else-if=\"book.requested && !book.allocated\" type=\"button\" class=\"btn btn-warning\" disabled>\n                Requested\n              </button>\n              <button v-else-if=\"book.allocated && book.read === 0\" type=\"button\" class=\"btn btn-success\" disabled>\n                Allocated\n              </button>\n              <button v-else-if=\"book.read === 1\" type=\"button\" class=\"btn btn-primary\" @click=\"userRequests(book.id, book.section)\">\n                Request\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    \n    </div>\n  </div>\n\n</template>\n\n<script>\nimport NavBar from \"../../components/NavBar.vue\";\n\nimport axios from \"axios\";\n\nexport default {\n  data() {\n    return {\n      userName: \"\",\n      books: [],\n      searchBar: \"\",\n    };\n  },\n  name: \"UserDashboard\",\n  components: {\n    NavBar,\n  },\n  computed: {\n    bookSections() {\n      return Array.from(new Set(this.books.map(book => book.section)));\n    }\n  },\n  methods: {\n    async getBookList() {\n      try {\n        const response = await axios.get(\"http://127.0.0.1:5000/api/books\", {\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem(\"accessToken\")}`,\n          },\n        });\n        this.books = response.data;\n        await this.setUsersLastVisitTime();\n        await this.fetchBookCovers();\n      } catch (error) {\n        console.error(\"Error fetching books:\", error);\n      }\n    },\n    readBook(book_id) {\n      this.$router.push({ name: 'BookPage', params: { id: book_id} });\n    },\n    searchSections(section) {\n      return this.books.filter(book => {\n        const sectionMatch = book.section === section;\n        const searchMatch = \n          book.name.toLowerCase().includes(this.searchBar.toLowerCase()) ||\n          book.authors.toLowerCase().includes(this.searchBar.toLowerCase());\n        return sectionMatch && (this.searchBar === \"\" || searchMatch);\n      });\n    },\n    async fetchBookCovers() {\n      for (const book of this.books) {\n        try {\n          const coverUrl = await this.getBookCover(book);\n          book.coverUrl = coverUrl;\n        } catch (error) {\n          console.error(\"Error fetching book cover:\", error);\n          book.coverUrl = null; \n        }\n      }\n    },\n    getBookCover(book) {\n      const apiUrl = `http://localhost:5000/bookcover?book_title=${encodeURIComponent(book.name)}\n      &author_name=${encodeURIComponent(book.authors)}\n      &isbn=${encodeURIComponent(book.isbn)}`;\n\n      return axios\n        .get(apiUrl)\n        .then((response) => {\n          console.log(response.data);\n          return response.data;\n        })\n        .catch((error) => {\n          console.error(\"Error fetching book cover:\", error);\n          return null;\n        });\n    },\n    userRequests(bookId, sectionName) {\n      console.log(bookId, sectionName);\n      const requestData = {\n        book_id: bookId,\n      };\n      axios\n        .post(\"http://127.0.0.1:5000/api/request/book\", requestData, {\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem(\"accessToken\")}`,\n          },\n        })\n        .then((response) => {\n          console.log(response.data);\n          console.log(\"Request sent\");\n          this.getBookList();\n        })\n        .catch((error) => {\n          alert(error.response.data.error);\n          console.log(error);\n        });\n    },\n    async setUsersLastVisitTime(){\n      const response = await axios.post(\"http://127.0.0.1:5000/api/track-last-login\" ,{}, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"accessToken\")}`,\n        }\n      })\n      if (response.status === 200) {\n        console.log(\"Last login time updated: \", response.data);\n      } else {\n        console.error(\"Failed to update last login time: \", response.data.error);\n      }\n    },\n    scrollHorizontal(direction) {\n        const scrollContainer = document.querySelector(\".row\");\n        const scrollAmount = 300 * direction;\n        scrollContainer.scrollBy({\n          left: scrollAmount,\n          behavior: \"smooth\"\n        });\n      }\n  },\n  mounted() {\n    this.userName = JSON.parse(localStorage.getItem(\"user\"));\n    this.getBookList();\n  },\n};\n</script>\n\n<style scoped>\n\n.section-title {\n  background-color: #222;\n  color:white;\n  text-align: center;\n}\n\n.book-cover {\n  height:150px;\n  align-items: start;\n  object-fit: contain;\n  margin-bottom: 0.25rem;\n}\n\n.book-cover.disabled-image {\n  opacity: 0.5;\n}\n\n.book-actions {\n  display: flex;\n  gap: 10px;\n  justify-content: center;\n}\n\n.btn {\n  color: white;\n  border: none;\n  justify-content: center;\n}\n\n.btn:hover {\n  background-color: rgba(72, 255, 72, 0.9);\n}\n\n.btn-warning {\n  background-color: rgba(255, 221, 0, 0.719);\n  color: black;\n  pointer-events: none;\n  cursor: not-allowed;\n  opacity: 0.5;\n}\n\n.btn-warning:hover {\n  background-color: rgba(255, 221, 0, 0.9);\n}\n\n.btn-primary {\n  background-color: rgba(0, 123, 255, 0.719);\n}\n\n.btn-primary:hover {\n  background-color: rgba(0, 123, 255, 0.9);\n}\n\n.row {\n  margin-left:0.75%;\n  align-items: stretch;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  overflow-x: auto;\n  overflow-y: hidden;\n}\n\n.card {\n  max-width: 13.333%;\n  padding: .75rem;\n  margin-bottom: 2rem;\n  border: 0;\n  flex-basis: 33.333%;\n  flex-grow: 0;\n  flex-shrink: 0;\n}\n\n.card-img-top {\n  margin-bottom: .75rem;\n  width: 100%;\n  height: 300px;\n}\n\n.card-text {\n  font-size: 85%;\n}\n\n::-webkit-scrollbar {\n  width: 12px;\n  height: 12px;\n}\n\n::-webkit-scrollbar-button {\n  width: 0;\n  height: 0;\n}\n\n::-webkit-scrollbar-thumb {\n  background: rgba(0, 0, 0, 0.5);\n  border-radius: 6px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: rgba(0, 0, 0, 0.6);\n}\n\n::-webkit-scrollbar-track {\n  background: rgba(0, 0, 0, 0.1);\n  border-radius: 6px;\n}\n\n.scroll-button {\n      position: absolute;\n      top: 60%;\n      transform: translateY(-50%);\n      background: transparent;\n      cursor: pointer;\n      padding: 5px;\n      font-size: 1.5em;\n      color: white;\n      background-color: #007bff;\n  }\n  \n  .scroll-button.prev {\n      left: 2;\n  }\n  \n  .scroll-button.next {\n      right: 0;\n  }\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}