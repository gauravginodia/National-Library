{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, normalizeClass as _normalizeClass, createCommentVNode as _createCommentVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nimport _imports_0 from '@/assets/default.jpeg';\nconst _withScopeId = n => (_pushScopeId(\"data-v-1b2be8df\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  style: {\n    \"text-align\": \"center\",\n    \"font-weight\": \"bold\",\n    \"margin-top\": \"1%\"\n  }\n};\nconst _hoisted_2 = {\n  class: \"section-title-wrapper\"\n};\nconst _hoisted_3 = {\n  class: \"section-title\"\n};\nconst _hoisted_4 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"i\", {\n  class: \"bi bi-arrow-left\"\n}, null, -1 /* HOISTED */));\nconst _hoisted_5 = [_hoisted_4];\nconst _hoisted_6 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"i\", {\n  class: \"bi bi-arrow-right\"\n}, null, -1 /* HOISTED */));\nconst _hoisted_7 = [_hoisted_6];\nconst _hoisted_8 = {\n  class: \"row\",\n  style: {\n    \"background-color\": \"whitesmoke\"\n  }\n};\nconst _hoisted_9 = {\n  class: \"card-body\"\n};\nconst _hoisted_10 = [\"onClick\"];\nconst _hoisted_11 = [\"src\"];\nconst _hoisted_12 = {\n  key: 1,\n  src: _imports_0,\n  loading: \"lazy\",\n  class: \"card-img-top\",\n  alt: \"Default Cover\"\n};\nconst _hoisted_13 = {\n  class: \"card-subtitle mb-2 text-muted\",\n  style: {\n    \"text-align\": \"center\"\n  }\n};\nconst _hoisted_14 = {\n  class: \"book-actions text-center\"\n};\nconst _hoisted_15 = [\"onClick\"];\nconst _hoisted_16 = {\n  key: 1,\n  type: \"button\",\n  class: \"btn btn-warning\",\n  disabled: \"\"\n};\nconst _hoisted_17 = {\n  key: 2,\n  type: \"button\",\n  class: \"btn btn-success\",\n  disabled: \"\"\n};\nconst _hoisted_18 = [\"onClick\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_NavBar = _resolveComponent(\"NavBar\");\n  return _openBlock(), _createElementBlock(\"div\", null, [_createVNode(_component_NavBar), _createElementVNode(\"div\", null, [_createElementVNode(\"h3\", _hoisted_1, \"Welcome, \" + _toDisplayString($data.userName), 1 /* TEXT */), _withDirectives(_createElementVNode(\"input\", {\n    style: {\n      \"width\": \"100%\",\n      \"padding\": \"0.5%\",\n      \"border-width\": \"0.5cap\",\n      \"border-radius\": \"10cqb\",\n      \"color\": \"black\",\n      \"font-weight\": \"700\",\n      \"font-size\": \"large\",\n      \"text-align\": \"center\",\n      \"border-color\": \"black\",\n      \"margin-bottom\": \"2%\"\n    },\n    type: \"text\",\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.searchBar = $event),\n    placeholder: \"Search by book or author\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.searchBar]])]), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($options.bookSections, (section, index) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: index\n    }, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"h2\", _hoisted_3, _toDisplayString(section), 1 /* TEXT */)]), _createElementVNode(\"button\", {\n      class: \"scroll-button prev\",\n      onClick: _cache[1] || (_cache[1] = $event => $options.scrollHorizontal(-1))\n    }, [..._hoisted_5]), _createElementVNode(\"button\", {\n      class: \"scroll-button next\",\n      onClick: _cache[2] || (_cache[2] = $event => $options.scrollHorizontal(1))\n    }, [..._hoisted_7]), _createElementVNode(\"div\", _hoisted_8, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($options.searchSections(section), book => {\n      return _openBlock(), _createElementBlock(\"div\", {\n        key: book.id,\n        class: \"card\",\n        style: {\n          \"background-color\": \"whitesmoke\"\n        }\n      }, [_createElementVNode(\"div\", _hoisted_9, [_createElementVNode(\"button\", {\n        onClick: $event => $options.readBook(book.id),\n        style: {\n          \"border\": \"none\"\n        }\n      }, [book.coverUrl ? (_openBlock(), _createElementBlock(\"img\", {\n        key: 0,\n        src: book.coverUrl,\n        loading: \"lazy\",\n        class: _normalizeClass([\"card-img-top\", {\n          'disabled-image': book.requested || book.allocated\n        }]),\n        alt: \"Book Cover\"\n      }, null, 10 /* CLASS, PROPS */, _hoisted_11)) : (_openBlock(), _createElementBlock(\"img\", _hoisted_12))], 8 /* PROPS */, _hoisted_10), _createElementVNode(\"h6\", _hoisted_13, \" by \" + _toDisplayString(book.authors), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_14, [book.read === 0 && book.allocated === 0 && !book.requested ? (_openBlock(), _createElementBlock(\"button\", {\n        key: 0,\n        type: \"button\",\n        class: \"btn btn-primary mr-2\",\n        onClick: $event => $options.userRequests(book.id, book.section)\n      }, \" Request \", 8 /* PROPS */, _hoisted_15)) : book.requested && !book.allocated ? (_openBlock(), _createElementBlock(\"button\", _hoisted_16, \" Requested \")) : book.allocated && book.read === 0 ? (_openBlock(), _createElementBlock(\"button\", _hoisted_17, \" Allocated \")) : book.read === 1 ? (_openBlock(), _createElementBlock(\"button\", {\n        key: 3,\n        type: \"button\",\n        class: \"btn btn-primary\",\n        onClick: $event => $options.userRequests(book.id, book.section)\n      }, \" Request \", 8 /* PROPS */, _hoisted_18)) : _createCommentVNode(\"v-if\", true)])])]);\n    }), 128 /* KEYED_FRAGMENT */))])]);\n  }), 128 /* KEYED_FRAGMENT */))]);\n}","map":{"version":3,"names":["_imports_0","style","class","_createElementVNode","_hoisted_4","_hoisted_6","key","src","loading","alt","type","disabled","_createElementBlock","_createVNode","_component_NavBar","_hoisted_1","_toDisplayString","$data","userName","_cache","$event","searchBar","placeholder","_Fragment","_renderList","$options","bookSections","section","index","_hoisted_2","_hoisted_3","onClick","scrollHorizontal","_hoisted_5","_hoisted_7","_hoisted_8","searchSections","book","id","_hoisted_9","readBook","coverUrl","_normalizeClass","requested","allocated","_hoisted_11","_hoisted_12","_hoisted_10","_hoisted_13","authors","_hoisted_14","read","userRequests","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_createCommentVNode"],"sources":["C:\\Users\\vijay\\OneDrive\\Desktop\\National-Library-LMS\\Library_Code\\frontend_library\\src\\views\\User\\UserDashboard.vue"],"sourcesContent":["<template>\n   \n  <div>\n    <NavBar/>\n   <div>\n    <h3 style=\"text-align: center;font-weight: bold;margin-top: 1%;\">Welcome, {{ userName }}</h3>\n    <input style=\"width:100%;padding: 0.5%;border-width:0.5cap;border-radius: 10cqb; color:black;font-weight: 700;font-size:large;text-align: center;border-color: black;margin-bottom:2%\" type=\"text\" v-model=\"searchBar\" placeholder=\"Search by book or author\">\n  </div>\n    <div v-for=\"(section, index) in bookSections\" :key=\"index\">\n      <div class=\"section-title-wrapper\">\n        <h2 class=\"section-title\">{{ section }}</h2>\n      </div>\n      <button class=\"scroll-button prev\" @click=\"scrollHorizontal(-1)\">\n          <i class=\"bi bi-arrow-left\"></i>\n        </button>\n        <button class=\"scroll-button next\" @click=\"scrollHorizontal(1)\">\n          <i class=\"bi bi-arrow-right\"></i>\n        </button>\n      <div class=\"row\" style=\"background-color:whitesmoke;\">\n        <div v-for=\"book in searchSections(section)\" :key=\"book.id\" class=\"card\" style=\"background-color:whitesmoke;\">\n          <div class=\"card-body\">\n            <button @click=\"readBook(book.id)\" style=\"border: none;\">\n            <template v-if=\"book.coverUrl\">\n              <img :src=\"book.coverUrl\" loading=\"lazy\" class=\"card-img-top\"\n                :class=\"{ 'disabled-image': book.requested || book.allocated }\" alt=\"Book Cover\">\n            </template>\n            <template v-else>\n              <img src=\"@/assets/default.jpeg\" loading=\"lazy\" class=\"card-img-top\" alt=\"Default Cover\">\n            </template>\n          </button>\n            <h6 class=\"card-subtitle mb-2 text-muted\" style=\"text-align: center;\"> by {{ book.authors }}</h6>\n            <div class=\"book-actions text-center\">\n              <button v-if=\"book.read === 0 && book.allocated === 0 && !book.requested\" type=\"button\"\n                class=\"btn btn-primary mr-2\" @click=\"userRequests(book.id, book.section)\">\n                Request\n              </button>\n              <button v-else-if=\"book.requested && !book.allocated\" type=\"button\" class=\"btn btn-warning\" disabled>\n                Requested\n              </button>\n              <button v-else-if=\"book.allocated && book.read === 0\" type=\"button\" class=\"btn btn-success\" disabled>\n                Allocated\n              </button>\n              <button v-else-if=\"book.read === 1\" type=\"button\" class=\"btn btn-primary\" @click=\"userRequests(book.id, book.section)\">\n                Request\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    \n    </div>\n  </div>\n\n</template>\n\n<script>\nimport NavBar from \"../../components/NavBar.vue\";\n\nimport axios from \"axios\";\n\nexport default {\n  data() {\n    return {\n      userName: \"\",\n      books: [],\n      searchBar: \"\",\n    };\n  },\n  name: \"UserDashboard\",\n  components: {\n    NavBar,\n  },\n  computed: {\n    bookSections() {\n      return Array.from(new Set(this.books.map(book => book.section)));\n    }\n  },\n  methods: {\n    async getBookList() {\n      try {\n        const response = await axios.get(\"http://127.0.0.1:5000/api/books\", {\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem(\"accessToken\")}`,\n          },\n        });\n        this.books = response.data;\n        await this.setUsersLastVisitTime();\n        await this.fetchBookCovers();\n      } catch (error) {\n        console.error(\"Error fetching books:\", error);\n      }\n    },\n    readBook(book_id) {\n      this.$router.push({ name: 'BookPage', params: { id: book_id} });\n    },\n    searchSections(section) {\n      return this.books.filter(book => {\n        const sectionMatch = book.section === section;\n        const searchMatch = \n          book.name.toLowerCase().includes(this.searchBar.toLowerCase()) ||\n          book.authors.toLowerCase().includes(this.searchBar.toLowerCase());\n        return sectionMatch && (this.searchBar === \"\" || searchMatch);\n      });\n    },\n    async fetchBookCovers() {\n      for (const book of this.books) {\n        try {\n          const coverUrl = await this.getBookCover(book);\n          book.coverUrl = coverUrl;\n        } catch (error) {\n          console.error(\"Error fetching book cover:\", error);\n          book.coverUrl = null; \n        }\n      }\n    },\n    getBookCover(book) {\n      const apiUrl = `http://localhost:5000/bookcover?book_title=${encodeURIComponent(book.name)}\n      &author_name=${encodeURIComponent(book.authors)}\n      &isbn=${encodeURIComponent(book.isbn)}`;\n\n      return axios\n        .get(apiUrl)\n        .then((response) => {\n          console.log(response.data);\n          return response.data;\n        })\n        .catch((error) => {\n          console.error(\"Error fetching book cover:\", error);\n          return null;\n        });\n    },\n    userRequests(bookId, sectionName) {\n      console.log(bookId, sectionName);\n      const requestData = {\n        book_id: bookId,\n      };\n      axios\n        .post(\"http://127.0.0.1:5000/api/request/book\", requestData, {\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem(\"accessToken\")}`,\n          },\n        })\n        .then((response) => {\n          console.log(response.data);\n          console.log(\"Request sent\");\n          this.getBookList();\n        })\n        .catch((error) => {\n          alert(error.response.data.error);\n          console.log(error);\n        });\n    },\n    async setUsersLastVisitTime(){\n      const response = await axios.post(\"http://127.0.0.1:5000/api/track-last-login\" ,{}, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"accessToken\")}`,\n        }\n      })\n      if (response.status === 200) {\n        console.log(\"Last login time updated: \", response.data);\n      } else {\n        console.error(\"Failed to update last login time: \", response.data.error);\n      }\n    },\n    scrollHorizontal(direction) {\n        const scrollContainer = document.querySelector(\".row\");\n        const scrollAmount = 300 * direction;\n        scrollContainer.scrollBy({\n          left: scrollAmount,\n          behavior: \"smooth\"\n        });\n      }\n  },\n  mounted() {\n    this.userName = JSON.parse(localStorage.getItem(\"user\"));\n    this.getBookList();\n  },\n};\n</script>\n\n<style scoped>\n\n.section-title {\n  background-color: #222;\n  color:white;\n  text-align: center;\n}\n\n.book-cover {\n  height:150px;\n  align-items: start;\n  object-fit: contain;\n  margin-bottom: 0.25rem;\n}\n\n.book-cover.disabled-image {\n  opacity: 0.5;\n}\n\n.book-actions {\n  display: flex;\n  gap: 10px;\n  justify-content: center;\n}\n\n.btn {\n  color: white;\n  border: none;\n  justify-content: center;\n}\n\n.btn:hover {\n  background-color: rgba(72, 255, 72, 0.9);\n}\n\n.btn-warning {\n  background-color: rgba(255, 221, 0, 0.719);\n  color: black;\n  pointer-events: none;\n  cursor: not-allowed;\n  opacity: 0.5;\n}\n\n.btn-warning:hover {\n  background-color: rgba(255, 221, 0, 0.9);\n}\n\n.btn-primary {\n  background-color: rgba(0, 123, 255, 0.719);\n}\n\n.btn-primary:hover {\n  background-color: rgba(0, 123, 255, 0.9);\n}\n\n.row {\n  margin-left:0.75%;\n  align-items: stretch;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  overflow-x: auto;\n  overflow-y: hidden;\n}\n\n.card {\n  max-width: 13.333%;\n  padding: .75rem;\n  margin-bottom: 2rem;\n  border: 0;\n  flex-basis: 33.333%;\n  flex-grow: 0;\n  flex-shrink: 0;\n}\n\n.card-img-top {\n  margin-bottom: .75rem;\n  width: 100%;\n  height: 300px;\n}\n\n.card-text {\n  font-size: 85%;\n}\n\n::-webkit-scrollbar {\n  width: 12px;\n  height: 12px;\n}\n\n::-webkit-scrollbar-button {\n  width: 0;\n  height: 0;\n}\n\n::-webkit-scrollbar-thumb {\n  background: rgba(0, 0, 0, 0.5);\n  border-radius: 6px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: rgba(0, 0, 0, 0.6);\n}\n\n::-webkit-scrollbar-track {\n  background: rgba(0, 0, 0, 0.1);\n  border-radius: 6px;\n}\n\n.scroll-button {\n      position: absolute;\n      top: 60%;\n      transform: translateY(-50%);\n      background: transparent;\n      cursor: pointer;\n      padding: 5px;\n      font-size: 1.5em;\n      color: white;\n      background-color: #007bff;\n  }\n  \n  .scroll-button.prev {\n      left: 2;\n  }\n  \n  .scroll-button.next {\n      right: 0;\n  }\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}